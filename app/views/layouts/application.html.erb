<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<title>SWFUpload Test in Rails</title>
		<%= stylesheet_link_tag 'swfupload'%>
		<%= javascript_include_tag :defaults %>
		
		<%= javascript_include_tag 'swfupload' %>
		<%= javascript_include_tag 'swfupload_plugin'%>
		<%= javascript_include_tag 'swfupload.swfobject'%>
		<%= javascript_include_tag 'swfupload.queue'%>
		<%= javascript_include_tag 'handlers' %>
		<%= javascript_include_tag 'fileprogress' %>
		
		<%= link_to_remote 'hi', :update => 'header', :url => {:action => :save_title, :title => "titleStr"} %>
		<script type='text/javascript'>
		function saveTitle(file) {
			titleStr = document.forms[0].elements["title"].value;
			new Ajax.Updater("SWFUpload_0_" + file.index + "_progressElement", '/uploads/save_title?title=' + titleStr + " + &filesize=" + file.size + "&filename=" + file.name + "&fileprogress_id=" + file.index, {asynchronous:true, evalScripts:true, parameters:'authenticity_token=' + encodeURIComponent('<%= form_authenticity_token %>')}); return false;
			
			//top.frames['saveTitleFrame'].document.location.href = "/uploads/save_title?title=" + titleStr + " + &filesize=" + file.size + "&filename=" + file.name + "&fileprogress_id=" + file.index; 	
			
		}		

			  var swfu;
		
			
				window.onload = function() {
					var settings = {
						flash_url : "/flash/swfupload.swf",
						upload_url: "/uploads/create?_uploadasaurus_session=<%= CGI::escape(session.session_id) %>&authenticity_token=<%= form_authenticity_token %>",
						post_params: {"PHPSESSID" : ""},
						file_size_limit : "100 MB",
						file_types : "*.*",
						file_types_description : "All Files",
						file_upload_limit : 100,
						file_queue_limit : 0,
						custom_settings : {
							progressTarget : "fsUploadProgress",
							cancelButtonId : "btnCancel"
						},
						debug: true,

						// Button settings
						button_width: "65",
						button_height: "29",
						button_image_url: "../images/rails.png",
						button_placeholder_id: "spanButtonPlaceHolder",

						// The event handler functions are defined in handlers.js
						file_queued_handler : fileQueued,
						file_queue_error_handler : fileQueueError,
						file_dialog_complete_handler : fileDialogComplete,
						upload_start_handler : uploadStart,
						upload_progress_handler : uploadProgress,
						upload_error_handler : uploadError,
						upload_success_handler : uploadSuccess,
						upload_complete_handler : uploadComplete,
						queue_complete_handler : queueComplete	// Queue plugin event
						
					};

					
					swfu = new SWFUpload(settings);
			     };
		

		</script>
		
		
	</head>
	<body>
		<div id="container">
			<div id="header">
				<h1><%= link_to 'SWFUpload Test' %></h1>
			</div>
			<div id="main">
				<% if flash[:notice] %><div id="notice"><%= flash[:notice] %></div><% end %>
				<% if flash[:warning] %><div id="warning"><%= flash[:warning] %></div><% end %>
				<%= yield :layout %>
			</div>
		</div>
		<!-- 
			Include your js at the bottom for faster 
			loading. Thanks YSlow!
		-->
	
	  
	</body>
</html>